def get_analysis_prompt(call_text: str) -> str:
    return f"""Ты — самый опытный менеджер продукта. Анализируй обращение клиента в поддержку: находи корневую бизнес-боль, глубинный страх, желаемый результат и реальные цитаты клиента.
Важно:
• Опирайся только на текст обращения.
• Не придумывай фактов, которых нет.
• Формулируй коротко, точно, в одном предложении.
• Строго соблюдай JSON-формат.

Задача:
Проанализируй обращение клиента и верни структурированный вывод.

**Текст обращения:**
{call_text}

Формат ответа (строго JSON):
{{
"main_problem": "Краткая формулировка главной проблемы в одном предложении",
"key_fear": "Глубинный страх клиента, стоящий за его обращением", 
"result_solution": "Желаемый результат или конечное состояние, к которому стремится клиент",
"original_phrases": ["Цитата 1", "Цитата 2", "Цитата 3"],
"tags": ["тег1", "тег2", "тег3"]
}}

Правила формирования параметров:

main_problem
Опиши только одну корневую проблему, влияющую на работу или бизнес клиента.

key_fear
Укажи глубинное эмоциональное опасение клиента (потеря денег, потеря клиентов, потеря контроля, зависимость от нестабильного сервиса, репутационные риски).

result_solution
Опиши только итоговое состояние, которого клиент хочет достичь. Не пиши фичи и не предлагай реализацию.

original_phrases
Используй только точные цитаты клиента из обращения (без перефразирования).

tags
Укажи 2–5 компактных тегов: тип проблемы, канал, продуктовый модуль, платформа, уровень риска, сегмент.

Если в тексте нет данных для какого-то поля — создай краткую корректную формулировку на основе доступной информации, не выдумывая новые детали."""

def get_product_insights_prompt(analysis_data: dict) -> str:
    return f"""
Ты — продуктовый аналитик. На основе анализа клиентского обращения сформулируй продуктовые инсайты и рекомендации для развития продукта.

**Данные анализа:**
- Основная проблема: {analysis_data.get('main_problem', 'Не определена')}
- Глубинный страх: {analysis_data.get('key_fear', 'Не определен')}
- Желаемый результат: {analysis_data.get('result_solution', 'Не определен')}
- Цитаты клиента: {analysis_data.get('original_phrases', [])}
- Теги: {analysis_data.get('tags', [])}

**Задача:**
Сформулируй продуктовые инсайты, которые помогут:
- Улучшить пользовательский опыт
- Решить выявленные боли клиентов
- Увеличить ценность продукта
- Снизить риски и страхи пользователей

**Требования:**
- Инсайты должны быть основаны на реальных цитатах и проблемах клиента
- Предложения должны быть конкретными и реализуемыми
- Учитывай глубинные страхи и желаемые результаты клиента
- Приоритет определяй на основе влияния на пользовательский опыт

Используй реальные цитаты клиента из original_phrases для обоснования инсайтов.
"""

def get_webhook_analysis_prompt(call_text: str) -> str:
    return get_analysis_prompt(call_text)  # Можно использовать тот же промпт или кастомизировать